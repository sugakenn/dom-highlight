class CheckPoint{CHECK_POINT_TYPE_START=0;CHECK_POINT_TYPE_END=1;constructor(t,e,n){this.node=t,this.index=e,this.type=n}}class CheckString{RESULT_NOT_HIT=0;RESULT_PART_HIT=1;RESULT_ALL_HIT=2;CHECK_POINT_CONST=new CheckPoint(null,0,0);#intMaxLength=0;points=[];previousNode=null;constructor(t){this.strSearch=t,this.intMaxLength=t.length,this.intCurrentSearchIndex=0,this.previousNode=null,this.points=[]}check(t,e){let n=!1;var i=t.textContent.charAt(e);return this.previousNode!==t&&(this.previousNode=t,n=!0),0==this.intCurrentSearchIndex?(this.points=[],this.points.push(new CheckPoint(t,e,this.CHECK_POINT_CONST.CHECK_POINT_TYPE_START))):n&&(this.points.push(new CheckPoint(this.points[this.points.length-1].node,this.points[this.points.length-1].node.textContent.length-1,this.CHECK_POINT_CONST.CHECK_POINT_TYPE_END)),this.points.push(new CheckPoint(t,e,this.CHECK_POINT_CONST.CHECK_POINT_TYPE_START))),this.strSearch.charAt(this.intCurrentSearchIndex)==i?(this.intCurrentSearchIndex++,this.intCurrentSearchIndex==this.intMaxLength?(this.points.push(new CheckPoint(t,e,this.CHECK_POINT_CONST.CHECK_POINT_TYPE_END)),this.intCurrentSearchIndex=0,this.RESULT_ALL_HIT):this.RESULT_PART_HIT):(this.intCurrentSearchIndex=0,this.RESULT_NOT_HIT)}getCheckPoints(){return this.points}}class ScanNode{constructor(t){this.elRoot=t,this.textNodes=null,this.intNodeIndex=0,this.intStringIndex=-1,this.position=null}getTextNodes(e){switch(e.nodeType){case Node.ELEMENT_NODE:switch(e.tagName){case"SCRIPT":case"STYLE":break;default:for(let t=0;t<e.childNodes.length;t++)this.getTextNodes(e.childNodes[t])}break;case Node.TEXT_NODE:this.textNodes.push(e)}}next(){return null==this.textNodes&&(this.textNodes=[],this.getTextNodes(this.elRoot)),this.textNodes.length<=this.intNodeIndex?null:(this.intStringIndex++,this.intStringIndex<this.textNodes[this.intNodeIndex].textContent.length?{node:this.textNodes[this.intNodeIndex],index:this.intStringIndex}:(this.intStringIndex=-1,this.intNodeIndex++,this.next()))}savePosition(){this.position={node:this.intNodeIndex,string:this.intStringIndex}}clearPosition(){this.position=null}backToSavedPosition(){this.position&&(this.intNodeIndex=this.position.node,this.intStringIndex=this.position.string)}}class HighlightString{CHECK_POINT_CONST=new CheckPoint(null,0,0);getOriginalData(){return this.original||null}highlightString(t,e=document.querySelector("body"),n="span",i="highlight"){this.original=e.cloneNode(!0),this.strWrapClassName=i,this.strWrapTagName=n;var i=e.cloneNode(!0),s=new CheckString(t),o=new ScanNode(i);let h=[],r=0;for(;;){var T=o.next();if(null==T)break;switch(T=s.check(T.node,T.index)){case s.RESULT_ALL_HIT:switch(r){case s.RESULT_ALL_HIT:case s.RESULT_PART_HIT:case s.RESULT_NOT_HIT:default:h=h.concat(s.getCheckPoints()),o.clearPosition()}break;case s.RESULT_PART_HIT:switch(r){case s.RESULT_ALL_HIT:case s.RESULT_NOT_HIT:o.savePosition();break;case s.RESULT_PART_HIT:}break;case s.RESULT_NOT_HIT:switch(r){case s.RESULT_PART_HIT:o.backToSavedPosition();break;case s.RESULT_ALL_HIT:case s.RESULT_NOT_HIT:}}r=T}return this.reflect(h),i}reflect(e){let n=[],i=null;for(let t=0;t<e.length;t++)i!==e[t].node&&(this.reflectSub(n),n=[]),n.push(e[t]),i=e[t].node;this.reflectSub(n)}reflectSub(s){if(0!=s.length){var o=[];let e="",n=0,i=!1;var h,r=s[0].node.textContent;for(let t=0;t<s.length;t++)switch(s[t].type){case this.CHECK_POINT_CONST.CHECK_POINT_TYPE_START:i?console.log("irregular value on 'type start' exception"):""!==(e=r.substring(n,s[t].index))&&o.push(document.createTextNode(e)),i=!0,n=s[t].index;break;case this.CHECK_POINT_CONST.CHECK_POINT_TYPE_END:i?""!==(e=r.substring(n,s[t].index+1))&&((h=document.createElement(this.strWrapTagName)).classList.add(this.strWrapClassName),h.textContent=e,o.push(h)):(console.log("irregular value on 'type end' exception"),""!==(e=r.substring(n,s[t].index+1))&&o.push(document.createTextNode(e))),i=!1,n=s[t].index+1;break;default:console.log("irregular value on 'type' exception")}i&&console.log("irregular value on 'end not exists' exception"),""!==(e=r.substring(n))&&o.push(document.createTextNode(e));var T=s[0].node.parentNode;for(let t=0;t<o.length;t++)T.insertBefore(o[t],s[0].node);s[0].node.remove()}}}